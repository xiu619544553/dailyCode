## 16.如何检测App运行过程中是否卡顿

监测卡顿的思路有两种

#### 1、RunLoop（最佳方案）



#### 2、监测 FPS

FPS（每秒传输帧数(Frames Per Second)）是图像领域中的定义，是指画面每秒传输帧数，通俗来讲就是指动画或视频的画面数，也就是一秒内画面变化数量。FPS是测量用于保存、显示动态视频的信息数量。每秒钟帧数越多，所显示的动作就会越流畅。

使用 `CADisplayLink`，`CADisplayLink` 是用于同步屏幕刷新频率的计时器。
大概思路：计算一秒屏幕刷新的次数，也就是 FPS
```objc
- (void)createDisplayLink {
    __weak typeof(self) weakSelf = self;
    _link = [CADisplayLink displayLinkWithTarget:weakSelf selector:@selector(tick:)];
    [_link addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSRunLoopCommonModes];
}

- (void)tick:(CADisplayLink *)link {
    if (_lastTime == 0) {
        // timestamp 当前时间戳
        _lastTime = link.timestamp;
        return;
    }
    
    _count++;
    NSTimeInterval diff = link.timestamp - _lastTime;
    if (diff < 1) return;
    _lastTime = link.timestamp;
    
    // 一秒内，屏幕刷新的次数
    float fps = _count / diff;
    
    // 重置
    _count = 0;
    
    NSString *fpsStr = [NSString stringWithFormat:@"%d FPS", (int)round(fps)];
}
```











